.PHONY: help install-oh-my-zsh setup-zsh install-plugins

ZSHRC_FILE = $(HOME)/.zshrc
BACKUP_FILE = $(HOME)/.zshrc.backup
OH_MY_ZSH_DIR = $(HOME)/.oh-my-zsh

# Installation compl√®te de zsh avec oh-my-zsh
setup-zsh: install-oh-my-zsh install-plugins
	@echo "üéâ Configuration zsh termin√©e!"
	@echo "‚ö†Ô∏è Red√©marrez votre terminal ou ex√©cutez 'exec zsh' pour activer oh-my-zsh"

# Installer oh-my-zsh avec le th√®me bira
install-oh-my-zsh:
	@echo "üîÑ Installation de oh-my-zsh..."
	@if [ ! -d $(OH_MY_ZSH_DIR) ]; then \
		echo "üîÑ T√©l√©chargement et installation de oh-my-zsh..."; \
		sh -c "$$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)" "" --unattended; \
		echo "‚úÖ oh-my-zsh install√© avec succ√®s!"; \
	else \
		echo "‚ùå oh-my-zsh est d√©j√† install√©"; \
	fi
	@echo "üîÑ Configuration du th√®me bira..."
	@sed -i 's/ZSH_THEME="robbyrussell"/ZSH_THEME="bira"/' $(ZSHRC_FILE) || true

# Installer les plugins populaires pour oh-my-zsh
install-plugins:
	@echo "üîÑ Installation des plugins zsh..."
	@if [ -d $(OH_MY_ZSH_DIR) ]; then \
		echo "üîÑ Installation de zsh-autosuggestions..."; \
		git clone https://github.com/zsh-users/zsh-autosuggestions $${ZSH_CUSTOM:-$(OH_MY_ZSH_DIR)/custom}/plugins/zsh-autosuggestions 2>/dev/null || echo "zsh-autosuggestions d√©j√† install√©"; \
		echo "üîÑ Installation de zsh-syntax-highlighting..."; \
		git clone https://github.com/zsh-users/zsh-syntax-highlighting.git $${ZSH_CUSTOM:-$(OH_MY_ZSH_DIR)/custom}/plugins/zsh-syntax-highlighting 2>/dev/null || echo "zsh-syntax-highlighting d√©j√† install√©"; \
		echo "üîÑ Configuration des plugins dans .zshrc..."; \
		sed -i 's/plugins=(git)/plugins=(git zsh-autosuggestions zsh-syntax-highlighting docker docker-compose npm node)/' $(ZSHRC_FILE) || true; \
		echo "‚úÖ Plugins install√©s et configur√©s!"; \
	else \
		echo "‚ùå oh-my-zsh n'est pas install√©. Ex√©cutez 'make install-oh-my-zsh' d'abord"; \
	fi

# D√©sinstaller oh-my-zsh
uninstall-oh-my-zsh:
	@if [ -d $(OH_MY_ZSH_DIR) ]; then \
		echo "üóëÔ∏è D√©sinstallation de oh-my-zsh..."; \
		rm -rf $(OH_MY_ZSH_DIR); \
		echo "‚úÖ oh-my-zsh d√©sinstall√©"; \
	else \
		echo "‚ùå oh-my-zsh n'est pas install√©"; \
	fi

# Afficher l'aide
help:
	@echo "Commandes disponibles:"
	@echo "  make setup-zsh          	- 	Installation compl√®te (oh-my-zsh)"
	@echo "  make install-oh-my-zsh  	- 	Installer oh-my-zsh avec le th√®me bira"
	@echo "  make install-plugins    	- 	Installer les plugins populaires"
	@echo "  make uninstall-oh-my-zsh	- 	D√©sinstaller oh-my-zsh"
	@echo "  make help               	- 	Afficher cette aide"